<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.qf.eason.dao.talkMapper">
    <resultMap id="talkMap" type="talk">
        <id property="udId" column="tb_user_doctor_id"/>

        <result property="doctorId" column="tb_doctor_id"/>
        <result property="userProblem" column="tb_user_doctor_problem"/>
        <result property="doctorAnswer" column="tb_user_doctor_solution"/>
        <result property="userImg" column="tb_user_doctor_img"/>
         <result property="userAppraise"  column="tb_user_doctor_appraise"/>
        <association property="user" column="tb_user_id" javaType="com.qf.eason.pojo.User">
            <result property="userNickname" column="tb_user_nickname"></result>
        </association>
        <association property="doctorinfor" column="tb_doctorinfor_id" javaType="com.qf.eason.pojo.Doctorinfor">
            <result property="doctorId" column="tb_doctorinfor_id"></result>
            <result property="realaName" column="tb_doctorinfor_realname"></result>
        </association>
    </resultMap>

    <insert id="addTalk" >
        insert into tb_user_doctor values(null,#{userId},#{doctorId},#{userProblem},null,#{userImg},null)
    </insert>
    <update id="answer">
        update tb_user_doctor set tb_user_doctor_solution=#{doctorAnswer} where tb_user_doctor_id=#{udId}
    </update>
   <!-- private  Integer udId;
   public List<Talk> showall();/
   public int addTalk(Talk talk);//添加用户提问记录
   public  int answer(Integer userid,Integer doctorId,String userProblem);//医生回答用户提问
    public  int answer(Integer userid,Integer doctorId,String userProblem);
    private  Integer userId;
    private  Integer doctorId;
    private  String userProblem;
    private  String doctorAnswer;
    private String userAppraise;-->
    <select id="showall" resultMap="talkMap">
       select u.tb_user_nickname,d.tb_doctorinfor_realname,ud.*
 from tb_user_doctor ud,tb_user u,tb_doctorinfor d where d.tb_doctorinfor_id=ud.tb_doctor_id
and ud.tb_user_doctor_id and u.tb_user_id=ud.tb_user_id and ud.tb_user_doctor_id
    </select>

    <select id="gerallProblem" resultMap="talkMap">
    select * from tb_user_doctor where tb_doctor_id=#{doctorId}
    </select>

    <select id="aboutFind" resultMap="talkMap">
        SELECT * FROM tb_user_doctor
        <where>
            <if test="tiaoJian!=null">
                AND tb_user_doctor_problem LIKE CONCAT(CONCAT ('%',#{tiaoJian}),'%')
            </if>
        </where>
    </select>
    <select id="findallbyname" parameterType="String" resultMap="talkMap">
        <if test="drugname!=null">
            <bind name="userProblem" value="'%'+drugname+'%'"/>
        </if>
        select * from tb_user_doctor
        <where>
            <if test="userProblem!=null">
                tb_user_doctor_problem like #{userProblem}
            </if>
        </where>
    </select>
</mapper>